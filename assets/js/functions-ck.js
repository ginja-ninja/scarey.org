window.scarey=window.scarey||{},scarey.medium="screen and (min-width: 50em)",scarey.large="screen and (min-width: 75em)",scarey.debounce=function(e,t,a){var r,n=a||500;$(window).on(e,function(){r&&clearTimeout(r),r=setTimeout(t,n)})},scarey.fastclick={init:function(){matchMedia(scarey.medium).matches||scarey.fastclick.go()},go:function(){$.getScript("/assets/js/libs/fastClick.js",function(){FastClick.attach(document.body)})}},scarey.scroll=function(e){$.scrollTo($(e),1e3,{easing:"easeInOutExpo",axis:"y",onAfter:function(){history.pushState(null,null,e)}})},scarey.nav=function(){var e=($("#nav"),$("#mobile-flyout"));$(".more-nav").click(function(){e.toggleClass("nav--active"),$(".main-content").toggleClass("dark"),event.preventDefault()})},scarey.filter={init:function(){$("body").hasClass("albums")&&(scarey.filter.toggle(),matchMedia(scarey.medium).matches?scarey.carousel():scarey.swipe())},toggle:function(){{var e,t=$(".filter"),a=$(".filter__toggle"),r=$(".filter__close"),n=$(".filter__slider-wrap a");location.hash}a.on("click",function(){t.toggleClass("showing")}),r.on("click",function(){t.removeClass("showing")}),n.on("click",function(a){e=$(this).attr("href"),a.preventDefault(),t.removeClass("showing"),setTimeout(function(){scarey.scroll(e)},300)})}},scarey.carousel=function(){function e(){a(),r(),n(),c()}function t(){$(x).each(function(){$(this).off("click"),$(this).remove()}),x.length=0,k.off("click"),C.off("click"),g.css("width",""),$(window).off("resize"),i("reset"),matchMedia(scarey.medium).matches?e():scarey.swipe()}function a(){d=matchMedia(scarey.large).matches?S.itemsPerSlideBig:matchMedia(scarey.medium).matches?S.itemsPerSlideMed:S.itemsPerSlideSmall}function r(){var e;for(e=b/d,h=0;e>h;h++)_.append("<a class='bullet'></a>");$("#position a").each(function(){var e=$(this);x.push(e)}),l=0,s(0)}function n(){d>=b?(f=w*b,$(".filter__controls").hide(),$(x).each(function(){$(this).hide()})):f=w*d,g.css("width",f),y.css("width",w*b)}function s(e){l+=e,$(x).each(function(){$(this).removeClass("on")}),$(x[l]).addClass("on")}function o(e){return e.substr(7,e.length-8).split(", ")}function i(e,t,a,r){p=parseInt(o(y.css("transform"))[4],10),u="forward"===e?p-f*a:p+f*a,m="forward"===e&&Math.abs(p)+f===w*b||"backward"===e&&0===p,m||("reset"===e?y.css({"-webkit-transform":"translate3d(0, 0, 0)","-moz-transform":"translate3d(0,0,0)","-o-transform":"translate3d(0,0,0)","-ms-transform":"translate3d(0,0,0)",transform:"translate3d(0,0,0)"}):Modernizr.csstransforms3d?(y.css({"-webkit-transform":"translate3d("+u+"px, 0, 0)","-moz-transform":"translate3d("+u+"px,0,0)","-o-transform":"translate3d("+u+"px,0,0)","-ms-transform":"translate3d("+u+"px,0,0)",transform:"translate3d("+u+"px,0,0)"}),r(t)):(y.css({"-webkit-transform":"left:"+u+"px)","-moz-transform":"left:"+u+"px)","-o-transform":"left:"+u+"px)","-ms-transform":"left:"+u+"px)",transform:"left:"+u+"px)"}),r(t)))}function c(){k.on("click",function(){i("forward",1,1,s)}),C.on("click",function(){i("backward",-1,1,s)}),$(x).each(function(e){$(this).on("click",function(){var t=e-l,a=Math.abs(t);e!==l&&(e>l?i("forward",t,a,s):i("backward",t,a,s))})}),scarey.debounce("resize",t,500)}if($(".filter").length){var l,d,f,u,p,m,h,g=$(".filter__slider"),y=$(".filter__slider-wrap"),v=$(".filter__slider-wrap li"),w=v.innerWidth(),b=v.length,C=$(".prev"),k=$(".next"),x=[],_=$("#position"),S={itemsPerSlideBig:4,itemsPerSlideMed:2,itemsPerSlideSmall:1};e()}},scarey.swipe=function(){var e=$("#slider li"),t=(e.length,[]),a=$("#position");$(e).each(function(){a.append("<a class='bullet'></a>")}),$("#position a ").each(function(){var e=$(this);t.push(e)}),$("#position a:first-child").addClass("on"),$(t).each(function(e){$(this).on("click",function(){mySwipe.slide(e,200)})}),window.mySwipe=$("#slider").Swipe({continuous:!1,callback:function(e){for(var a=t.length;a--;)t[a].removeClass("on");t[e].addClass("on")}}).data("Swipe")},scarey.history=function(e){var t=e.History,a=e.jQuery,r=e.document;return t.enabled?void a(function(){var n=".wrap",s=a(n).filter(":first"),o=s.get(0),i=a(e),c=a(r.body),l=t.getRootUrl();0===s.length&&(s=c),a.expr[":"].internal=function(e){var t,r=a(e),n=r.attr("href")||"";return t=n.substring(0,l.length)===l||-1===n.indexOf(":")};var d=function(e){var t=String(e).replace(/<\!DOCTYPE[^>]*>/i,"").replace(/<(html|head|body|title|meta|script)([\s\>])/gi,'<div class="document-$1"$2').replace(/<\/(html|head|body|title|meta|script)\>/gi,"</div>");return t};a.fn.ajaxify=function(){var e=a(this);return e.find(".page-nav a").click(function(e){var r=a(this),n=r.attr("href"),s=r.attr("title")||null;return 2===e.which||e.metaKey?!0:(t.pushState(null,s,n),e.preventDefault(),!1)}),e},c.ajaxify(),i.bind("statechange",function(){function i(){a.ajax({url:f,success:function(t){var i,c,l=a(d(t)),p=l.find(".document-body:first"),m=p.find(n).filter(":first");if(c=m.find(".document-script"),c.length&&c.detach(),i=m.html()||l.html(),!i)return r.location.href=f,!1;s.html(i).ajaxify(),scarey.reload(),r.title=l.find(".document-title:first").text();try{r.getElementsByTagName("title")[0].innerHTML=r.title.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(h){}c.each(function(){var e=a(this),t=e.text(),n=e.attr("src"),s=r.createElement("script");n?(s.src=n,o.appendChild(s)):(s.appendChild(r.createTextNode(t)),o.appendChild(s))}),a(".main-content").addClass("slide-fade-from-left"),"undefined"!=typeof e._gaq&&e._gaq.push(["_trackPageview",u])},error:function(){return r.location.href=f,!1}})}var c=t.getState(),f=c.url,u=f.replace(l,"");a(".main-content").addClass("slide-fade-to-right"),setTimeout(i,300)})}):!1}(window),scarey.colorbox={init:function(){matchMedia(scarey.medium).matches&&$.getScript("/assets/js/libs/colorbox.js",function(){scarey.colorbox.go()})},go:function(){$(".colorbox-container a").colorbox({rel:"group",scalePhotos:!0,maxHeight:"900px",speed:200,opacity:".7",onComplete:function(){$(".wrap").on("click",function(){$.colorbox.close()})}})}},scarey.flipper=function(){var e=$(".flipper-wrap");e.on("click",function(){$(this).toggleClass("flipper-wrap--flipped")})},scarey.photoset=function(){$(".scarey-photoset")&&($(".scarey-photoset").collagePlus({fadeSpeed:200,effect:"photoset-transition",direction:"vertical"}),scarey.debounce("resize",scarey.photoset,500))},scarey.loadMore=function(){var e=$("#load-more"),t=1;e.on("click",function(){$(this).addClass("loading"),t++,$.ajax({url:"/page/"+t,dataType:"html",success:function(t){e.removeClass("loading");var a=$(t).find(".post");a.addClass("slide-fade-from-bottom"),$(a).insertBefore(e),setTimeout(scarey.photoset,300)},error:function(){e.removeClass("loading"),e.attr("disabled","disabled"),$("<p class='center gamma'>No more posts!</p>").insertBefore(e)}})})},scarey.visitorCheck=function(){var e=($("body"),$("#slide-from-left-1")),t=$("#slide-from-left-2"),a=$("#slide-from-right"),r=$("#slide-from-bottom"),n=$("#slide-from-bottom-2");"localStorage"in window&&null!==window.localStorage&&(!localStorage.getItem("returning_visitor")==!0?(e.addClass("slide-fade-from-left"),t.addClass("slide-fade-from-left"),a.addClass("slide-fade-from-right"),r.addClass("slide-fade-from-bottom"),n.addClass("slide-fade-from-bottom"),localStorage.setItem("returning_visitor",!0)):(e.css("opacity",1),t.css("opacity",1),a.css("opacity",1),r.css("opacity",1),n.css("opacity",1)))},scarey.photoGrid=function(){function e(){t(),a()}function t(){matchMedia(scarey.large).matches?o=18:matchMedia(scarey.medium).matches?o=12:(o=2,l=!0)}function a(){n.removeClass("grid--loaded"),n.addClass("grid--loading");var e=$.ajax({url:"/assets/php/instagram.php",type:"POST",data:{count:o,max_id:i},dataType:"json"});e.always(function(){n.removeClass("grid--loading")}),e.done(function(e){n.addClass("grid--loaded"),s.prop("disabled",!1),s.css("opacity",1);var t,a=JSON.parse(e);for(t=0;o>t;t++){var l=a.data[t].images,d=a.data[t].caption?a.data[t].caption.text:"";c.push(l.thumbnail.url),i=a.pagination.next_max_id,r(l.thumbnail.url,l.standard_resolution.url,d)}scarey.colorbox.init()}),e.fail(function(e,t){console.log("request failed :"+t),n.append("<p>There was an error requesting the images from Instagram</p>")})}function r(e,t,a){var r=l?t:e;n.append('<a title="'+a+'" href="'+t+'"><img src="'+r+'"></a>')}var n=$("#photo-grid"),s=$("#load-more--instagram"),o=0,i="",c=[],l=!1;s.on("click",function(){a()}),$("#photo-grid").length&&e()},scarey.collapse=function(){if($(".collapse__trigger")){var e=$(".collapse__trigger");e.on("click",function(){$(this).toggleClass("bold"),$(this).parent().toggleClass("collapse--collapsed"),$(this).next().toggleClass("collapse__content--showing")})}},scarey.tour=function(){function e(e){return 10>e?"0"+e:e}function t(){o.hide(),s.append('<p class="center italic">No currently scheduled shows.</p>')}function a(e){function t(e){var t;t=e.ticket_url?'<a class="underlined-link" target="_blank" href="'+e.ticket_url+'">'+e.venue.name+"</a>":e.venue.name,p.append('<p class="tour-date">'+u+'</p><p class="tour-city">'+e.formatted_location+'</p><p class="tour-venue">'+t+'<span class="bold"> '+e.support.denoter+"</span></p>"),o.append(p)}function a(){var e=$("<div>").attr("class","tour-support");for(var t in s)e.append('<p><span class="bold">'+s[t]+" </span>w/ "+t+"</p>");e.insertBefore(o)}var r,n,s={},i=0,c=["*","^","#"],l=0;for(r=0;r<e.length;r++){var d=e[r];d.support={};var f=/(january|february|march|april|may|june|july|august|september|october|november|december)\s(\d+),\s(\d){4}/i,u=d.formatted_datetime.match(f)[0],p=$("<div>").attr("class","tour-event");if(d.artists.length>1)for(var m=1;m<d.artists.length;m++)s[d.artists[m].name]||(c[i]||(n=c[l],n+=n.split("")[0],l++,c.push(n)),s[d.artists[m].name]=c[i],i++),d.support.name=d.artists[m].name,d.support.denoter=s[d.support.name]||"*";else d.support.denoter="";t(d)}a()}if($(".tour--upcoming").length||$(".tour--past").length){var r,n="scarey.org",s=$(".tour .main-content"),o=$(".tour-block");if($(".tour--upcoming").length)r="upcoming";else if($(".tour--past").length){r="2011-01-01,";var i=new Date,c=i.getFullYear(),l=e(i.getMonth()+1),d=e(i.getDate()-1);r+=c+"-"+l+"-"+d}s.addClass("loading");var f=$.ajax({type:"GET",dataType:"jsonp",url:"http://api.bandsintown.com/artists/S Carey/events.json?api_version=2.0&date="+r+"&app_id="+n,timeout:8e3});f.done(function(e){e.length?a(e):t()}),f.fail(function(){s.append('<p class="center">There was an error requesting the data from Bands In Town.  Please try again or visit this link: </p><p class="center"><a target="_blank" href="http://www.bandsintown.com/S.Carey">http://www.bandsintown.com/S.Carey</a></p>')}),f.always(function(){s.removeClass("loading")})}},scarey.reload=function(){scarey.nav(),scarey.filter.init(),scarey.colorbox.init(),scarey.fastclick.init(),scarey.flipper(),scarey.loadMore(),scarey.visitorCheck(),scarey.photoGrid(),scarey.collapse(),scarey.tour(),window.picturefill()},$(document).ready(function(){scarey.nav(),scarey.filter.init(),scarey.colorbox.init(),scarey.fastclick.init(),scarey.flipper(),scarey.loadMore(),scarey.visitorCheck(),scarey.photoGrid(),scarey.collapse(),scarey.tour()}),$(window).load(function(){scarey.photoset()});